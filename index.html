<!DOCTYPE html>
<html lang="ne">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#d4af37">
<meta charset="UTF-8">
<title>‡§Ü‡§ú‡§ï‡•ã ‡§∏‡•Å‡§® ‡§ö‡§æ‡§Å‡§¶‡•Ä‡§ï‡•ã ‡§Æ‡•Ç‡§≤‡•ç‡§Ø</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#ffffff;
  --text:#000;
  --card:#f9f9f9;
}
.dark{
  --bg:#121212;
  --text:#fff;
  --card:#1e1e1e;
}
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.container{
  width:100%;
  max-width:480px;
  padding:20px;
  border-radius:16px;
  background:var(--bg);
  box-shadow:0 12px 30px rgba(0,0,0,.2);
}
h1{text-align:center;color:#d4af37;}
.subtitle{text-align:center;font-size:13px;}
.card{
  margin-top:15px;
  padding:15px;
  border-radius:12px;
  background:var(--card);
}
.gold{border-left:6px solid #d4af37;}
.silver{border-left:6px solid #9e9e9e;}
.price{font-size:20px;font-weight:bold;}
.small{font-size:13px;}
select,input,button{
  width:100%;
  margin-top:8px;
  padding:8px;
}
.stat{text-align:center;margin-top:10px;}
.toggle{margin-top:10px;}
footer{text-align:center;font-size:11px;margin-top:10px;}
</style>
</head>

<body>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js")
    .then(() => console.log("Service Worker Registered"));
}
</script>
<div class="container">
<h1>‡§Ü‡§ú‡§ï‡•ã ‡§∏‡•Å‡§® ‡§∞ ‡§ö‡§æ‡§Å‡§¶‡•Ä</h1>
<div class="subtitle" id="nepaliDate"></div>

<button class="toggle" onclick="toggleDark()">üåô Dark Mode</button>

<div class="card gold">
  <b>‡§∏‡•Å‡§®‡§ï‡•ã ‡§Æ‡•Ç‡§≤‡•ç‡§Ø</b>
  <div id="goldPrice" class="price">‡§≤‡•ã‡§° ‡§π‡•Å‡§Å‡§¶‡•à‡§õ...</div>
  <select id="purity" onchange="updatePurity()">
    <option value="1">‡•®‡•™ ‡§ï‡•ç‡§Ø‡§æ‡§∞‡•á‡§ü</option>
    <option value="0.916">‡•®‡•® ‡§ï‡•ç‡§Ø‡§æ‡§∞‡•á‡§ü</option>
    <option value="0.75">‡•ß‡•Æ ‡§ï‡•ç‡§Ø‡§æ‡§∞‡•á‡§ü</option>
  </select>
</div>

<div class="card silver">
  <b>‡§ö‡§æ‡§Å‡§¶‡•Ä‡§ï‡•ã ‡§Æ‡•Ç‡§≤‡•ç‡§Ø</b>
  <div id="silverPrice" class="price">‡§≤‡•ã‡§° ‡§π‡•Å‡§Å‡§¶‡•à‡§õ...</div>
</div>

<div class="stat" id="ratio"></div>

<div class="card">
  <b>‡§§‡•ã‡§≤‡§æ ‡§ï‡•ç‡§Ø‡§æ‡§≤‡•ç‡§ï‡•Å‡§≤‡•á‡§ü‡§∞</b>
  <input type="number" id="tolaInput" placeholder="‡§§‡•ã‡§≤‡§æ ‡§≤‡•á‡§ñ‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç" oninput="calcValue()">
  <div class="small" id="calcResult"></div>
</div>

<div class="card">
  <b>‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§Ö‡§≤‡§∞‡•ç‡§ü (‡§∏‡•Å‡§®)</b>
  <input type="number" id="alertPrice" placeholder="‡§∞‡•Å ‡§≤‡•á‡§ñ‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç">
  <button onclick="setAlert()">‡§Ö‡§≤‡§∞‡•ç‡§ü ‡§∏‡•á‡§ü ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
</div>

<div class="stat" id="updateTime"></div>

<footer>‡§∏‡•ç‡§∞‡•ã‡§§: MetalpriceAPI</footer>
</div>

<script>
const API_KEY="fb50a9b30286a3bb7d0cbdb1d9e5fe77";
const OUNCE_TO_TOLA=2.6666667;
let gold=0,silver=0,alertValue=null;

/* Nepali digits */
function nep(num){
  return num.toString().replace(/\d/g,d=>"‡•¶‡•ß‡•®‡•©‡•™‡•´‡•¨‡•≠‡•Æ‡•Ø"[d]);
}

/* Dark mode */
function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("dark",document.body.classList.contains("dark"));
}
if(localStorage.getItem("dark")==="true"){
  document.body.classList.add("dark");
}

/* Date */
function nepaliDate(){
  const d=new Date();
  document.getElementById("nepaliDate").innerText=
   `‡§Ü‡§ú‡§ï‡•ã ‡§Æ‡§ø‡§§‡§ø: ${nep(d.getFullYear())}-${nep(d.getMonth()+1)}-${nep(d.getDate())}`;
}

/* Load prices */
async function load(){
  const g=await fetch(`https://api.metalpriceapi.com/v1/latest?api_key=${API_KEY}&base=XAU&currencies=NPR`);
  const s=await fetch(`https://api.metalpriceapi.com/v1/latest?api_key=${API_KEY}&base=XAG&currencies=NPR`);
  const gd=await g.json(), sd=await s.json();

  gold=gd.rates.NPR/OUNCE_TO_TOLA;
  silver=sd.rates.NPR/OUNCE_TO_TOLA;

  updatePurity();
  document.getElementById("silverPrice").innerText=
    `‡§∞‡•Å ${nep(silver.toFixed(2))} / ‡§§‡•ã‡§≤‡§æ`;

  document.getElementById("ratio").innerText=
    `‡§∏‡•Å‡§®‚Äì‡§ö‡§æ‡§Å‡§¶‡•Ä ‡§Ö‡§®‡•Å‡§™‡§æ‡§§: ${nep((gold/silver).toFixed(2))}`;

  const now=new Date();
  document.getElementById("updateTime").innerText=
    `‡§Ö‡§®‡•ç‡§§‡§ø‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü: ${nep(now.toLocaleTimeString())}`;

  if(alertValue && gold>=alertValue){
    alert("üîî ‡§∏‡•Å‡§®‡§ï‡•ã ‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§§‡§™‡§æ‡§à‡§Ç‡§ï‡•ã ‡§Ö‡§≤‡§∞‡•ç‡§ü ‡§™‡•Å‡§ó‡•á‡§ï‡•ã ‡§õ!");
    alertValue=null;
  }
}

function updatePurity(){
  const p=document.getElementById("purity").value;
  document.getElementById("goldPrice").innerText=
    `‡§∞‡•Å ${nep((gold*p).toFixed(2))} / ‡§§‡•ã‡§≤‡§æ`;
}

function calcValue(){
  const t=document.getElementById("tolaInput").value;
  if(!t) return;
  document.getElementById("calcResult").innerText=
    `‡§ï‡•Å‡§≤ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø: ‡§∞‡•Å ${nep((t*gold).toFixed(2))}`;
}

function setAlert(){
  alertValue=document.getElementById("alertPrice").value;
  alert("‡§Ö‡§≤‡§∞‡•ç‡§ü ‡§∏‡•á‡§ü ‡§≠‡§Ø‡•ã");
}

nepaliDate();
load();
setInterval(load,60000);
</script>
</body>
</html>
